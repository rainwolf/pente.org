<!DOCTYPE html>
<!--[if lte IE 8]>
	<html id="scoped-css" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://opengraphprotocol.org/schema/" class="not-logged-in no-js   commerce  oldie">
<![endif]-->
<!--[if gt IE 8]><!-->
<html id="scoped-css" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://opengraphprotocol.org/schema/" class="not-logged-in no-js   commerce "><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"4722504a69","applicationID":"7554975","transactionName":"IQxWQRdXDQ1UEUtCFgcRS1wRXU4RUAQBREoRC1dC","queueTime":5,"applicationTime":309,"agent":""}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(e,t){return function(){o(e,[(new Date).getTime()].concat(a(arguments)),null,t)}}var o=e("handle"),i=e(2),a=e(3);"undefined"==typeof window.newrelic&&(newrelic=NREUM);var u=["setPageViewName","setCustomAttribute","finished","addToTrace","inlineHit"],c=["addPageAction"],f="api-";i(u,function(e,t){newrelic[t]=r(f+t,"api")}),i(c,function(e,t){newrelic[t]=r(f+t)}),t.exports=newrelic,newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),o("err",[e,(new Date).getTime()])}},{}],2:[function(e,t,n){function r(e,t){var n=[],r="",i=0;for(r in e)o.call(e,r)&&(n[i]=t(r,e[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],3:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(0>o?0:o);++r<o;)i[r]=e[t+r];return i}t.exports=r},{}],ee:[function(e,t,n){function r(){}function o(e){function t(e){return e&&e instanceof r?e:e?u(e,a,i):i()}function n(n,r,o){e&&e(n,r,o);for(var i=t(o),a=l(n),u=a.length,c=0;u>c;c++)a[c].apply(i,r);var s=f[g[n]];return s&&s.push([m,n,r,i]),i}function p(e,t){w[e]=l(e).concat(t)}function l(e){return w[e]||[]}function d(e){return s[e]=s[e]||o(n)}function v(e,t){c(e,function(e,n){t=t||"feature",g[n]=t,t in f||(f[t]=[])})}var w={},g={},m={on:p,emit:n,get:d,listeners:l,context:t,buffer:v};return m}function i(){return new r}var a="nr@context",u=e("gos"),c=e(2),f={},s={},p=t.exports=o();p.backlog=f},{}],gos:[function(e,t,n){function r(e,t,n){if(o.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[t]=r,r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){o.buffer([e],r),o.emit(e,t,n)}var o=e("ee").get("handle");t.exports=r,r.ee=o},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!w++){var e=v.info=NREUM.info,t=s.getElementsByTagName("script")[0];if(e&&e.licenseKey&&e.applicationID&&t){c(l,function(t,n){e[t]||(e[t]=n)});var n="https"===p.split(":")[0]||e.sslForHttp;v.proto=n?"https://":"http://",u("mark",["onload",a()],null,"api");var r=s.createElement("script");r.src=v.proto+e.agent,t.parentNode.insertBefore(r,t)}}}function o(){"complete"===s.readyState&&i()}function i(){u("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var u=e("handle"),c=e(2),f=window,s=f.document;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:f.XMLHttpRequest,REQ:f.Request,EV:f.Event,PR:f.Promise,MO:f.MutationObserver},e(1);var p=""+location,l={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-943.min.js"},d=window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent),v=t.exports={offset:a(),origin:p,features:{},xhrWrappable:d};s.addEventListener?(s.addEventListener("DOMContentLoaded",i,!1),f.addEventListener("load",r,!1)):(s.attachEvent("onreadystatechange",o),f.attachEvent("onload",r)),u("mark",["firstbyte",a()],null,"api");var w=0},{}]},{},["loader"]);</script>

	<title>Bruce Cropley - PentAI</title>

	

		<script>if(typeof console == "undefined") { window.console = { log: function () {} }; }</script>

<link href="http://content.sitezoogle.com/u/79199/f7cc2d8a4b8a66c3a7d589e8de3ec803e99619e3/ico/favicon.ico?1378745150" rel="shortcut icon" type="image/vnd.microsoft.icon">



<meta content="width=device-width" name="viewport">

<link href="Bruce%20Cropley%20-%20PentAI_files/application-2737f3a587cb535fe8e6cf51a7ea4e42.css" media="screen" rel="stylesheet" type="text/css">

	<link href="Bruce%20Cropley%20-%20PentAI_files/stylesheet.css" rel="stylesheet" type="text/css">


	<meta content="Bruce Cropley, musician, composer, jazz music, piano jazz, film music, solo musician, atonal, game music, eigenharp, jazz piano" name="keywords">

<link href="Bruce%20Cropley%20-%20PentAI_files/usersite_print-9e99490af3055939c0c408f19ba88339.css" media="print" rel="stylesheet" type="text/css">




	<meta content="authenticity_token" name="csrf-param">
<meta content="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" name="csrf-token">

	<meta content="Bruce Cropley - PentAI" name="title">
<meta content="Bruce Cropley - PentAI" property="og:title">
<meta content="PentAI. Bruce Cropley, an ambient, celtic, classical, comedy, composer, electronica, experimental, funk, jazz, latin, new age, other / not classifiable, rock, world artist from Melbourne" name="description">
<meta content="PentAI. Bruce Cropley, an ambient, celtic, classical, comedy, composer, electronica, experimental, funk, jazz, latin, new age, other / not classifiable, rock, world artist from Melbourne" property="og:description">
<meta content="http://bruce-cropley.com/pentai" name="url">
<meta content="http://bruce-cropley.com/pentai" property="og:url">


	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<!--[if lte IE 9]>
		<script src="//s3.amazonaws.com/content.sitezoogle.com/assets/history.iegte8.min-1754442e86c6a25282160b564bab1153.js" type="text/javascript"></script>
	<![endif]-->

	<script protocol="relative" src="Bruce%20Cropley%20-%20PentAI_files/application-84e92646e1e6935ea0bd6a29919a95ef.js" type="text/javascript"></script>

	

	

</head>


<body class="theme-style-157 theme-style-157-d has-swmp not-intro-page">

	

	


		<div class="usersite-container-wrap">
			<div id="usersite-container" class="">
							<nav class="mobile" id="main-nav"><ul class="mobile list balance_6 top"><li class="top"><div><a href="http://bruce-cropley.com/home" class="top" title="Home">Home</a></div></li><li class="has-submenu top"><div><a href="http://bruce-cropley.com/music" class="top" title="Music">Music</a></div><ul><li class="subpage"><div><a href="http://bruce-cropley.com/modal-podal" class="" title="Modal Podal">Modal Podal</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/we-are-alive" class="" title="We Are Alive">We Are Alive</a></div></li></ul></li><li class="has-submenu top"><div><a href="http://bruce-cropley.com/about" class="top" title="About">About</a></div><ul><li class="subpage"><div><a href="http://bruce-cropley.com/influences" class="" title="Influences">Influences</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/studio" class="" title="Studio">Studio</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/techniques" class="" title="Techniques">Techniques</a></div></li></ul></li><li class="top"><div><a href="http://bruce-cropley.com/quotes" class="top" title="Quotes">Quotes</a></div></li><li class="top"><div><a href="http://bruce-cropley.com/blog" class="top" title="Blog">Blog</a></div></li><li class="top"><div><a href="http://bruce-cropley.com/contact" class="top" title="Contact">Contact</a></div></li></ul></nav>

		<div data-pjax-container="">
			
	<div class="inner-page display-type-text website-page-pentai has-swmp" id="page-root">
		<div id="container-wrap">

	<div id="container">
		<header id="page-header">
			
		<div id="mobile-header">
	<div class="bar">
		<a href="javascript:" class="toggle-mobile-menu" id="toggle-menu"><i class="icon-hamburger"></i></a>
		<div class="project-name">Bruce Cropley</div>
	</div>
		<div class="page-photos">
	
<img alt="" class="page-photo" data-original-url="http://s3.amazonaws.com/content.sitezoogle.com/system/f4f36f416ffaeeb86906ecbad761777dcb4e1e89/original/95.jpg?1361845449" data-style-for-original="left: -4px; top: -168px; width: 768px;" src="Bruce%20Cropley%20-%20PentAI_files/page-photo-28253.jpg" style="">

</div>

</div>


		<div class="" data-text-fallbacks="{&quot;title&quot;:&quot;http://content.sitezoogle.com.s3.amazonaws.com/u/79199/style/title.png?1458190242&quot;}" id="header-wrap"><div class="layer-background layer"></div><div class="layer-photo layer"><div class="page-photos">
	
<img alt="" class="page-photo" data-original-url="http://s3.amazonaws.com/content.sitezoogle.com/system/f4f36f416ffaeeb86906ecbad761777dcb4e1e89/original/95.jpg?1361845449" data-style-for-original="left: -4px; top: -168px; width: 768px;" src="Bruce%20Cropley%20-%20PentAI_files/page-photo-28253.jpg" style="">

</div>
</div><div class="layer-frame layer"></div><div class="layer-title layer"><h1 class="page-title display-type-text" id="page-title"><a href="http://bruce-cropley.com/home" id="page-title-link"><span class="outer"><span class="inner">Bruce Cropley's Music</span></span></a></h1></div></div>

					<span class="toggle-mobile-menu" id="toggle-mobile-menu"><a href="javascript:"><i class="icon-hamburger"></i></a></span><nav class="non-mobile" id="main-nav"><ul class="horizontal list balance_6 top"><li class="top"><div><a href="http://bruce-cropley.com/home" class="top" title="Home">Home</a></div></li><li class="has-submenu top"><div><a href="http://bruce-cropley.com/music" class="top" title="Music">Music</a></div><ul><li class="subpage"><div><a href="http://bruce-cropley.com/modal-podal" class="" title="Modal Podal">Modal Podal</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/we-are-alive" class="" title="We Are Alive">We Are Alive</a></div></li></ul></li><li class="has-submenu top"><div><a href="http://bruce-cropley.com/about" class="top" title="About">About</a></div><ul><li class="subpage"><div><a href="http://bruce-cropley.com/influences" class="" title="Influences">Influences</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/studio" class="" title="Studio">Studio</a></div></li><li class="subpage"><div><a href="http://bruce-cropley.com/techniques" class="" title="Techniques">Techniques</a></div></li></ul></li><li class="top"><div><a href="http://bruce-cropley.com/quotes" class="top" title="Quotes">Quotes</a></div></li><li class="top selected"><div><a href="http://bruce-cropley.com/blog" class="top" title="Blog">Blog</a></div></li><li class="top"><div><a href="http://bruce-cropley.com/contact" class="top" title="Contact">Contact</a></div></li></ul></nav>

		</header>

		<div id="content-wrap">
			<div id="content-top"> </div>

			<div id="content">
				<div class="zoogle_flash">
</div>


				<section id="cart" class="cart bg-accent">
</section>

				
<table id="page-content-wrap"><tbody class="zoogle-content block" data-arrangement-id="503779"><tr class="zoogle-columns zoogle-columns-1 zoogle-columns-100 block block-row layout_full" data-row-id="2174412"><td class="zoogle-column zoogle-column-1-of-1 col_1_of_1 block layout_full" colspan="6" data-column-id="2228953"><div class="zoogle-feature block layout_full" data-block-id="1380413"><section class="feature text_feature" data-feature-id="543845"><span class="font_large"><strong><span class="font_xl">PentAI</span></strong><br>I
 have stopped making music for a little while, and have instead been 
writing a program to play the abstract strategic board game "<a contents="Pente" data-link-label="" data-link-type="url" href="http://en.wikipedia.org/wiki/Pente" target="_blank">Pente</a>".<br><img src="Bruce%20Cropley%20-%20PentAI_files/screen-shot-2014-03-24-at-11-08-30-pm.png" class="size_l justify_center border_"><br>I
 find this game to be a perfect fit for my requirements for a game: it 
is quick to learn (&lt; 5m), quick to play (~ 5m), and there is no luck 
involved, but it takes many games to learn how to play well. You can 
find out lots of information about Pente on the net, e.g. on <a contents="wikipedia" data-link-label="" data-link-type="" href="http://en.wikipedia.org/wiki/Pente">wikipedia</a>. This page is about how my computer program PentAI is constructed.</span><br>&nbsp;<hr><span class="font_large"><span class="font_xl"><strong>Artificial Intelligence</strong></span><br><strong>Position representation</strong><br>The board occupancies are stored as four arrays of integers,<br>one
 array per direction (E, SE, S, NE). Each number in the arrays 
represents a line across the board in that direction, and the pieces on 
it. Two bits are used per location, with 0 representing empty, 1 Black 
(Player 1), 2 White (P2), and 3 is unused. This allows for rapid pattern
 matching for lines, captures, threats and closed 4s in any direction, 
using bitwise operations such as AND, OR, XOR and shift.<br><br><img src="Bruce%20Cropley%20-%20PentAI_files/pentai-board.png" class="size_l justify_center border_"><br>This position would be represented in memory as:<br>E: [0, 0, 0, 0, 2048, 1024, 6160, 0, 0, 0, 0, 0, 0]</span>
<p class="p1"><span class="font_large">SE: [0, 0, 0, 0, 0, 0, 0, 0, 16, 2048, 1024, 2048, 4096, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span></p>
<p class="p1"><span class="font_large">S: [0, 0, 4096, 0, 0, 9728, 4096, 0, 0, 0, 0, 0, 0]</span></p>
<p class="p1"><span class="font_large">NE: [0, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 2048, 5120, 2048, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]<br><img src="Bruce%20Cropley%20-%20PentAI_files/compass.png" class="size_m justify_center border_"></span></p><span class="font_large">For
 instance, the 2048 in the East representation is for the white piece in
 the fifth row up - each number represents a whole line in that 
direction (horizontal row in this case). 2048 represents the 
presence&nbsp;</span><span style="font-size: 1.4em;">of a white piece in the 6th column, with nothing else in that row:</span><br><span class="font_large">4<sup>(6-1)</sup>&nbsp;x 2 = 2048</span><br><span class="font_large">i.e. 2 x zero bits for each of the 5 empty points to its left, and another bit for the white coloured stone.<br>Or in base 4 it would be 200000.<br><br>The
 numbers in the arrays start from the SW corner going up (N) for the E 
and SE arrays, from the NW corner going right (E) for the S array, and 
from the NW corner going down (S) for the NE array.<br><br>For a 19x19 board, that means the space used is:</span><br><span class="font_large">2 x 19 x 64 bits (horiz &amp; vert) = 2432<br>2 x 37 x 64 bits (for the diags) = 4736<br>+ a couple of bytes for capture counts and programming language overheads.<br>= Around 900 bytes per position.<br>However,
 the amount of space used per position is generally not a big deal, 
because the search is done depth-first, and the transposition table 
(described below) only uses one representation out of the four.</span><br><br><span class="font_large"><strong>Pattern Matching</strong><br>All
 pattern matching is currently done in 1d only. Capture and threat moves
 are detected using bitwise operations on a number representing a line 
as described above. Each pattern is represented as a number that is 
pre-calculated. For instance, the pattern number for capturing a pair to
 the left of the move position x is:<br>B W W x &nbsp; &nbsp; (1 x 1 &nbsp;+ &nbsp;2 x 4 &nbsp;+ &nbsp;2 &nbsp;x 16 &nbsp;+ &nbsp;0 x 64) = 41, or in base 4: 0221<br>The first numbers in each multiplication are 1 for B or 2 for W; the second numbers are powers of 4.<br>Whenever
 Black moves, the bits for the 4 locations up to and including the move 
position can be matched against this pattern number to check if it 
causes a black capture to the left of the move.</span>
<p><strong style="font-size: 1.4em;">Line Counts</strong></p><span class="font_large">There is another type of data that is used extensively by the AI player - potential line length counts.<br>The
 AI player counts the potential 5 in a row stretches per location, with 
the number of already occupied locations out of each line.<br><img src="Bruce%20Cropley%20-%20PentAI_files/line-counts.png" class="size_m justify_left border_none" alt=""><br><br>At the moment, there are several potential fives that can be extended by white playing at x.<br>Starting with the left 5, these have a current count of:<br>&nbsp; &nbsp;2 &nbsp;3 &nbsp;3 &nbsp;2 &nbsp;1<br>(the one represents the stretch from x to the right edge)<br><br>If white placed a stone at x, it would look like this:<br><img src="Bruce%20Cropley%20-%20PentAI_files/line-counts-2.png" class="size_m justify_left border_none" alt=""><br><br>and the counts would be:<br>&nbsp; 3 &nbsp;4 &nbsp;4 &nbsp;3 &nbsp;2<br><br>These
 counts are used for two things: to suggest locations as candidate 
moves, and to contribute to a utility value for each position.<br><br>Since
 this data is required for every position in the search tree, it is 
maintained incrementally; every time a stone is placed on the board or 
taken off, these counts are adjusted.<br><br><strong>Symmetry</strong><br>There are 8 equivalent positions for every position, from rotations or a whole board flip.</span>
<table border="0" cellpadding="0" cellspacing="30"><tbody>    <tr>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/rh.jpg" class="size_xl justify_center border_"></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/rh2.jpg" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/rh3.jpg" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/rh4.jpg" class="size_xl justify_center border_none" alt=""></td>    </tr>    <tr>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/lh1.jpg" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/lh2.jpg" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/lh3.jpg" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/lh4.jpg" class="size_xl justify_center border_none" alt=""></td>    </tr>
</tbody></table><br><span class="font_large">PentAI exploits this in its
 "Openings Book". It does this by matching a "canonical form" of the 
current game position against a hash table of canonical forms of 
previously played game positions. By <a contents="canonical form" data-link-label="" data-link-type="url" href="http://en.wikipedia.org/wiki/Canonical_form" target="_blank">canonical form</a>, I mean a representation of the game position that is unique to all symmetrical equivalents of that position.<br><br>For
 PentAI, I chose to use the minimum East array representation. To find 
the canonical representation, I iterate through the symmetrical 
equivalents by using a couple of flipping operations - a flip along the 
NE diagonal by swapping the E and S lines, and a left to right flip by 
reversing the order of the S array and reversing the order of the 2 bit 
sections of each of the numbers in the E array.<br><br>For example, assume that the current position is as above:<br>E: [0, 0, 0, 0, 2048, 1024, 6160, 0, 0, 0, 0, 0, 0]</span><br><span style="font-size: 1.4em;">S: [0, 0, 4096, 0, 0, 9728, 4096, 0, 0, 0, 0, 0, 0]</span><br><br><span class="font_large">(diagonal
 representations aren't required for canonisation because no amount of 
these flipping operations will get them into the E array)<br><br>Then after a NE diagonal flip, we would have:<br><br>E: [0, 0, 4096, 0, 0, 9728, 4096, 0, 0, 0, 0, 0, 0]</span><br><span class="font_large">S: [0, 0, 0, 0, 2048, 1024, 6160, 0, 0, 0, 0, 0, 0]</span>
<p class="p1"><br><span style="font-size: 1.4em;"><em>OR&nbsp;</em>after a L/R (= E/W) flip, we would have:</span></p>
<div>
<p class="p1"><span class="font_large">E: [0,</span><span style="font-size: 1.4em;">0,</span><span class="font_large">0,</span><span class="font_large">0,</span><span class="font_large">1048576,</span><span class="font_large">2097152,</span><span style="font-size: 1.4em;">135790592,</span><span class="font_large">0,</span><span class="font_large">0,</span><span class="font_large">0,</span><span class="font_large">0,</span><span class="font_large">0,</span><span style="font-size: 1.4em;">0]</span><br><span style="font-size: 1.4em;">S: [0, 0, 0, 0, 0, 0, 4096, 9728, 0, 0, 4096, 0, 0]</span><br>&nbsp;</p>
<p class="p1"><span style="font-size: 1.4em;">The minimum E 
representation out of these three would in this case be the original 
position (using Python's default array ordering):</span><br><span class="font_large">E: [0, 0, 0, 0, 2048, 1024, 6160, 0, 0, 0, 0, 0, 0]<br><br>(Although to calculate the real canonical representation for certain, you would need to compare all 8 symmetrical equivalents.)</span></p>
</div><strong><span class="font_large">Translational "Symmetry"</span></strong><br style="font-size: 16.66666603088379px;"><span style="font-size: 16.66666603088379px;">On
 a large (19x19) board, positions that are basically the same, just 
shifted slightly, left, right, up and/or down can be played as if they 
are the same. If there are any stones within 5 intersections of an edge 
in a given dimension, the board position is treated as not being movable
 in that dimension.<br>To implement this feature, the canonization routine just removes up to 5 leftmost and uppermost empty intersections.</span><br><br><span class="font_large"><strong>Openings Move Selection</strong><br>If
 the canonical position is in the Openings Book, it can be used to 
suggest a good move for the current player. There can be several games 
that have been played that match that position, with a number of wins 
and losses per move from that position, and ratings of the players per 
game. PentAI usually randomly selects one of these moves based on how 
many games were won or lost when that move was chosen. If the openings 
book doesn't suggest a move then it falls through to the normal 
deterministic search process.&nbsp;<br><br><strong>Automatic Learning</strong></span><br style="font-size: 16.66666603088379px;"><span class="font_large">Every
 game is automatically added to the openings book when it is completed. 
In this way, PentAI may appear to get smarter the more you play against 
it (though very slowly)</span><br style="font-size: 16.66666603088379px;"><br><span class="font_large"><strong>Deterministic Search</strong><br>PentAI
 searches the game tree for a fixed number of moves, currently with a 
maximum of 10 levels of depth. For each position, it searches a maximum 
of 9 alternatives. Leaf nodes of the search are evaluated and given a 
score which represents how good a position it is from the perspective of
 the player who is doing the search.<br><img src="Bruce%20Cropley%20-%20PentAI_files/tree.gif" class="size_xl justify_center border_none" alt=""><br>These
 values are bubbled up back to the top level of the search, and the best
 (of the worst of the best of the worst etc...) is chosen. The</span>&nbsp;<a contents="Alpha Beta algorithm" data-link-label="" data-link-type="url" href="http://en.wikipedia.org/wiki/Alpha%E2%80%93beta_pruning" style="font-size: 16.6666660308838px;" target="_blank">Alpha Beta algorithm</a><span style="font-size: 16.6666660308838px;">&nbsp;is used t</span><span class="font_large">o reduce the size of the tree searched, without altering the result.</span><br><span class="font_large">The
 width of the search is 9 alternatives for the top 3 levels of the 
search, then it is constrained to 5 alternatives per move for subsequent
 levels; this seems to give a good balance between playing strength and 
speed.<br><br><strong>Candidate Moves</strong><br>If every possible move
 was tried at every level of the search, the size of the game tree would
 blow out enormously, and we would only be able to search a couple of 
levels deep. For this reason, we need to reduce the number of moves, and
 only search those that are likely to be the best. Candidates are chosen
 from the "Line Counts" data described above, sorted from longest to 
shortest. This candidate selection is done for every position in the 
search tree except leaf nodes, for which a utility value is calculated.<br><br>The priority levels are as follows (with examples):</span>
<table border="0" cellpadding="10" cellspacing="1"><tbody>    <tr>        <td>&nbsp;</td>        <td style="text-align: center;"><span class="font_large">Us</span></td>        <td style="text-align: center;"><span class="font_large">Them</span></td>    </tr>    <tr>        <td><span class="font_large">4 out of 5</span></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/4a.png" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/4w.png" class="size_xl justify_center border_"></td>    </tr>    <tr>        <td><span class="font_large">Capture</span></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/cap-b.png" class="size_xl justify_center border_"></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/cap-w.png" class="size_xl justify_center border_"></td>    </tr>    <tr>        <td><span class="font_large">3 out of 5</span></td>        <td><span class="font_large"><img src="Bruce%20Cropley%20-%20PentAI_files/3a.png" class="size_xl justify_center border_none" alt=""></span></td>        <td><span class="font_large"><img src="Bruce%20Cropley%20-%20PentAI_files/3w.png" class="size_xl justify_center border_"></span></td>    </tr>    <tr>        <td><span class="font_large">Threaten</span></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/threat-b.png" class="size_xl justify_center border_"></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/threat-w.png" class="size_xl justify_center border_none" alt=""></td>    </tr>    <tr>        <td><span class="font_large">2 out of 5</span></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/2b.png" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/2w.png" class="size_xl justify_center border_"></td>    </tr>    <tr>        <td><span class="font_large">1 out of 5</span></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/1b.png" class="size_xl justify_center border_none" alt=""></td>        <td><img src="Bruce%20Cropley%20-%20PentAI_files/1w.png" class="size_xl justify_center border_"></td>    </tr>
</tbody></table><br><span class="font_large">This table should be read 
like a book: L-&gt;R, then down - For each of these levels, moves for 
the player whose turn it is ("Us") at this level of the search are given
 a higher priority than those for the opponent ("Them"), since in Pente,
 "Attack is the best Defence". The Xs mark a candidate move.<br><br>For example:<br>If
 it is black's turn, and one possibility is to extend a line of three, 
and another is to capture a pair, the capture will be searched first.<br><br>Another example:<br>If
 it is black's turn, and one possibility is to place a stone in a place 
that blocks a white three, and another possibility is to extend a black 
line of two, it will search the former first.<br><br>Note that the table
 is showing only horizontal examples - vertical and diagonals are given 
equal priorities to their horizontal cousins.<br><br><strong>Utility Score</strong><br>Positions
 are each given a value so they can be compared for relative 
desirability. The inputs for the utility score calculation are the 
number of captures by each player, and the total numbers of potential 
fives of each current length as described above. The longer current 
length lines contribute exponentially more than the shorter ones. The 
value of captures also increases with more captures to represent the 
increased likelihood of a win.<br>Positions that are won or lost are 
given a score of positive or negative infinity respectively, and don't 
need to be searched further.</span><br><br><strong style="font-size: 16.6666660308838px;">Enclosed fours</strong><br style="font-size: 16.6666660308838px;"><span style="font-size: 16.6666660308838px;">A
 line of four in a row that is blocked at both ends is often 
advantageous for that player, because if one of the blocking stones is 
captured, it becomes a half-open four, which must usually be answered 
immediately by the opponent. Enclosed fours are used by the utility 
calculator, but not by the candidate move selection.</span><br><br><span class="font_large"><strong>Transposition table</strong><br>Further
 into the game, symmetries of previously reached positions become rarer.
 However, the same position can easily occur in a different part of the 
game tree, due to a different ordering of the same moves.<br>For example, the position reached after:</span>
<p class="p1"><span style="font-size: 1.4em;">K10, L9, N10, L13 is identical to that after:</span></p>
<p class="p1"><span class="font_large">K10, L13, N10, L9</span></p>
<p class="p1"><span class="font_large">So in my understanding, that 
isn't a type of symmetry, it is exactly the same position; this is where
 a transposition table is handy.</span></p><span class="font_large">To avoid having to evaluate that position or subtree again,&nbsp;every position is stored in a <a contents="Transposition Table" data-link-label="" data-link-type="url" href="http://en.wikipedia.org/wiki/Transposition_table" target="_blank">Transposition Table</a> (just a python dict == hash table).</span>&nbsp;&nbsp;<span class="font_large">A
 single representation of the position is sufficient to use as a key, so
 the East strips are used. As each position is given a utility value, it
 is added to the transposition table.&nbsp;The value stored is the 
previously calculated utility score of that position.<br><br>Later when a
 position is searched, the first thing it does is to see if that 
position appears in the transposition table, and if so, use the utility 
value that was stored for that position. Note that before each move, the
 transposition table has to cleared to allow deeper search values to 
replace those found earlier.</span><br><br><span class="font_large"><strong>Tuning</strong><br>To
 find some good values for various parameters, many competitions were 
set up between handcrafted versions of the AI player algorithms. 
Parameters that have been tuned include:</span>
<ul>    <li><span class="font_large">Relative value of lines and captures</span></li>    <li><span class="font_large">Scaling factor of line length</span></li>    <li><span class="font_large">Scaling factor of more captured pairs</span></li>    <li><span class="font_large">Width of the search at different depth levels</span></li>    <li><span class="font_large">Alternative algorithms for selecting and ordering candidate moves</span></li>    <li><span class="font_large">Importance of existing capture threats</span></li>    <li><span class="font_large">Importance of potential capture threats</span></li>    <li><span class="font_large">A few methods of calculating an overall score</span></li>
</ul><span class="font_large">A <a contents="Genetic Algorithm" data-link-label="" data-link-type="url" href="http://en.wikipedia.org/wiki/Genetic_algorithm" target="_blank">Genetic Algorithm</a> could be used to tune the parameters, but hasn't been so far.</span><br>&nbsp;<hr><span class="font_large"><span class="font_xl"><strong>Implementation</strong></span><br>PentAI is written in the <a contents="Python programming language" data-link-label="" data-link-type="url" href="http://www.python.org/" target="_blank">Python programming language</a>. The user interface is written using the <a contents="Kivy library" data-link-label="" data-link-type="url" href="http://kivy.org/" target="_blank">Kivy library</a>, which provides platform independence between several mobile and standard computer platforms. (iOS, Android, OS X, Windows)<br><br><strong>Search Process</strong><br>The CPU intensive AI code is converted into C extension modules by <a contents="cython" data-link-label="" data-link-type="url" href="http://cython.org/" target="_blank">cython</a>.<br>To
 prevent the GUI from becoming unresponsive, the search is split into a 
separate process. This is currently spawned by the GUI each turn that a 
search is required, although it would be fairly easy to reuse the search
 process if that became necessary. On iOS, multithreading is used 
instead, as multiprocessing is not available.<br><br><strong>Persistence</strong><br>Most of the data storage is done using <u><a contents="ZODB" data-link-label="" data-link-type="url" href="http://www.zodb.org/" target="_blank">ZODB</a></u>.
 Sections for this format include those for Games, Players, and Openings
 Positions, and are equivalent to tables in a relational database, 
without having to jump through hoops to do object relational 
mapping.&nbsp;<br><br><strong>Settings</strong><br>For application wide 
settings, the PentAI program uses the standard python config module and 
the user interface is derived from the kivy settings module, though it 
is reimplemented.<br><br><strong>Sounds</strong><br>Most sound effects 
have four or more variants, and one is chosen randomly from them, except
 that the last sound in that category that was played is excluded.<br><br><strong>Playing badly</strong><br>Many
 people have suggested that it has to be able to play badly. Making this
 possible was MUCH easier than making it play well. It has been 
implemented by a couple of techniques:</span>
<ul>    <li><span class="font_large">Vision - a chosen percentage of candidate moves from every position are skipped.</span></li>    <li><span class="font_large">Judgement - every position evaluation is adjusted randomly; the lower the judgement value, the greater the randomness applied.</span></li>
</ul><span class="font_large">...or the user can simply reduce the search depth.<br><br><strong>Statistics</strong><br>Production python code size: 9327&nbsp;</span><span class="font_large">lines<br>Production cython code size: 3875 lines</span><br><span class="font_large">Test code size: 8250 lines<br>Unit Tests: 455, which run in around 0.54s<br>AI subsystem tests: 12 which run in &lt;20s<br>Screens: 18<br>Transposition table hits: ~8%</span><br><span class="font_large">Positions/s: ~1200<br>Depth 10 move time: ~35s<br>Depth 6 move time: ~3s<br>(times are for my laptop version, iPad is much slower)<br><br>I hope that was interesting and useful. The source code has been open sourced, and is available at&nbsp;<a contents="https://github.com/cropleyb/pentai" data-link-label="" data-link-type="url" href="https://github.com/cropleyb/pentai" target="_blank">https://github.com/cropleyb/pentai</a>. Feedback is most welcome :)</span></section></div></td></tr></tbody></table>

				<div class="clear"> </div>
			</div>

			<div id="content-bottom"> </div>
		</div>

	</div>

	<footer id="page-footer">
  <div class="block layout_full"><section class="feature text_feature" data-feature-id="209704"><span class="font_small">You are not visitor number 1,342,271,179. Copyright ©2012, 2013, 2014, 2015 Bruce Cropley</span></section></div>
  	<div class="branding text-tertiary">
		<small>
			<a href="http://bandzoogle.com/" rel="nofollow" target="_blank" title="Powered by Bandzoogle">Powered by Bandzoogle</a>
		</small>
	</div>

</footer>



</div>
</div>
		</div>
		
			<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-37159451-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

		
		<footer id="sticky-footer"><div class="block layout_full"><section class="feature music_feature" data-feature-id="30514">	<article class="music-player display-swmp">
		
<div class="details zoogle-music-player light-buttons without-track-artist" data-autostart="false" data-loop-playlist="true" data-shuffle="false">
	<div class="player" data-album-id="105194">
		<header>
			<div class="controls">
				<div class="player-play">
					<a href="#" class="button button-circle button-action play-button ">
						<span class="icon icon-play" title="Play"></span>
						<span class="icon icon-pause" title="Pause"></span>
					</a>
				</div>

				<div class="player-track track">
					<div class="player-track-inner">
						<div class="player-title">
							<div class="marquee-wrap"><div class="marquee title text-main alt-font"></div></div>
						</div>
						<div class="player-artist">
							<span class="ellipsis"><span class="artist"></span></span>
						</div>
						<div class="actions">
							<div class="share">

								<a href="#" class="share-link">Share</a>
								<div class="share-contents">
									Share this track <a href="#" class="share-link close">(Hide)</a>
									<div class="links"></div>
								</div>

							</div>
							<div class="action">
							</div>
						</div>
					</div>
				</div>

				<div class="player-nav">
					<nav class="track-nav ">
						<a href="#" class="button-action button-action-secondary previous-button text-main" title="Previous track">
  						<i class="icon icon-first"></i>
						</a>
						<a href="#" class="button-action button-action-secondary next-button text-main" title="Next track">
  						<i class="icon icon-last"></i>
						</a>
					</nav>
				</div>
			</div>
		</header>
		<div class="progress bg-accent">
	<div class="position bg-main"></div>
	<span class="player-time time text-tertiary">
		<time class="cur">0:00</time>
		<span class="sep">/</span>
		<time class="duration">0:00</time>
	</span>
</div>

	</div>

	<ol class="track-list">
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/418782.mp3" data-duration="01:53" data-title="Pixie Rock" type="audio/mp3">Pixie Rock</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="418782" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259435" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$0.99</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/418789.mp3" data-duration="03:56" data-title="Razorwire" type="audio/mp3">Razorwire</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="418789" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259437" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$1.10</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/418787.mp3" data-duration="03:42" data-title="Rain" type="audio/mp3">Rain</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="418787" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259439" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$1.10</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/418799.mp3" data-duration="03:15" data-title="Lazy Afternoon ft. Johnny Mindlin" type="audio/mp3">Lazy Afternoon ft. Johnny Mindlin</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="418799" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259440" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$1.10</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/411996.mp3" data-duration="02:22" data-title="Chimera" type="audio/mp3">Chimera</a>
			<span class="track-action">
				

		<a href="http://bruce-cropley.com/tracks/411996?trackship_id=259441" class="button download " target="_blank">Free</a>


			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="null" data-category="Plays" data-dest="/player/30514/tracks/418806.mp3" data-duration="03:14" data-title="Loss" type="audio/mp3">Loss</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="418806" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259442" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$1.10</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
		<li class="border-accent bg-accent-slight-hover">
			<a href="#" class="play" data-artist="" data-category="Plays" data-dest="/player/30514/tracks/476989.mp3" data-duration="05:30" data-title="Tuxedo" type="audio/mp3">Tuxedo</a>
			<span class="track-action">
				
		<form accept-charset="UTF-8" action="/go/cart/cart_items" class="trackship salable-item not-in-cart available without-quantity in-stock" data-item-id="476989" data-item-type="Track" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="xkP1DpOonVUloLRSu5kyozxRGEfO3m3Sl3RitlkscIw=" type="hidden"></div><input id="cart_item_item_id" name="cart_item[item_id]" value="259443" type="hidden"><input id="cart_item_item_type" name="cart_item[item_type]" value="Trackship" type="hidden">
			<button class="button add-to-cart">$0.99</button>

			<a class="button button-long if-in-cart" disabled="disabled">In cart</a>
			<em class="unless-available text-tertiary">Not Available</em>
			<em class="if-out-of-stock text-tertiary">Out of stock</em>
</form>
			</span>
		</li>
</ol>
</div>
</article></section></div></footer>


			</div>
		</div>


	


<style>#content > #center > .dose > .dosesingle,
#content > #right > .dose > .dosesingle
{display:none !important;}</style></body></html>